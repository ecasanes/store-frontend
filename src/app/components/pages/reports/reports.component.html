<section class="panel-header" style="padding-bottom: 25px;">
    <div class="panel-details">
        <div class="details">
            <h1>General Report</h1>
            <span class="sub-info"><i class="fa fa-th-large" aria-hidden="true"></i> Reports Generated</span>
        </div>
        <div class="actions">
            <button class="btn-action" (click)="onOpenExportModal(filter.branchId)">EXPORT DATA</button>
        </div>
    </div>
    <div class="panel-nav">

    </div>
</section>

<section class="panel-content">
    <div class="container">

        <div class="filter">
            <div class="by-store">
                <label>Store</label>
                <select class="custom-select" name="branch_id" [(ngModel)]="filter.branchId">
                    <option [value]="null">All stores</option>
                    <option *ngFor="let branch of branches; let i = index;" [value]="branch.id">
                        {{branch.name}}
                    </option>
                </select>
            </div>
            <div class="date-range">
                <label>Date Range</label>
                <div class="input-group input-daterange">
                    <div class="input-group-addon">from</div>
                    <input type="text" class="form-control" name="from" [(ngModel)]="filter.from"
                           placeholder="yyyy-mm-dd" ngbDatepicker #from="ngbDatepicker" (click)="from.toggle()">
                    <div class="input-group-addon">to</div>
                    <input type="text" class="form-control" name="to" [(ngModel)]="filter.to"
                           placeholder="yyyy-mm-dd" ngbDatepicker #to="ngbDatepicker" (click)="to.toggle()">
                </div>
            </div>
            <div class="submit">
                <button class="btn btn-submit" (click)="onClickGenerateReport()">Generate</button>
            </div>
        </div>

        <div class="results" style="position:relative;">

            <panel-loading [load]="loadingData" [type]="'calculate'"></panel-loading>

            <hr class="custom-divider">

            <div *ngIf="loaded">
                <div class="chart-list">
                    <div class="widget-header">
                        <h2>Graph</h2>
                    </div>

                    <p *ngIf="productsSalesSummary.length<=0">No items found</p>
                    <div class="bar-graph" *ngIf="productsSalesSummary.length>0">
                        <div class="bar-label">
                            <ul>
                                <li *ngFor="let i of graphIntervals;">{{i}}</li>
                            </ul>
                        </div>
                        <div class="bars">
                            <div class="bars-wrapper" [style.width.px]="productsSalesSummary.length*360">
                                <div *ngFor="let item of productsSalesSummary; let i = index;" class="bar"
                                     placement="top" triggers="mouseenter:mouseleave" container="body"
                                     [ngbPopover]="popoverContent">
                                    <ng-template #popoverContent>
                                        <span>{{item.product_name}}</span>
                                        <br>
                                        <span>{{item.quantity | number}} items sold</span>
                                        <br>
                                        <b>P{{item.sales | number : '1.2-2'}}</b>
                                        <i>Total Sales</i>
                                        <br>
                                        <b>P{{item.returns | number :'1.2-2'}}</b>
                                        <i>Returns</i>
                                    </ng-template>
                                    <span class="label">{{item.product_name}}</span>
                                    <div class="cost" [style.height.%]="getGraphSalesPercentage(item.returns)"></div>
                                    <div class="profit" [style.height.%]="getGraphSalesPercentage(item.sales)"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="top-products">
                    <div class="widget-header">
                        <h2>TOP PRODUCTS</h2>
                    </div>
                    <p *ngIf="topItems<=0">No items found</p>
                    <div class="widget-wrapper top-list" *ngIf="topItems.length>0">
                        <div *ngFor="let item of topItems; let i = index;">
                            <span class="product">{{item.product_name}} ({{item.size | number}} {{item.metrics}})</span>
                            <span class="qty-sold">{{item.sum | number}} Items Sold</span>
                        </div>
                    </div>
                </div>

                <div class="sales-summary">
                    <hr class="custom-divider">
                    <div class="widget-header">
                        <h2>SALES SUMMARY</h2>
                    </div>

                    <div class="widget-wrapper summary">
                        <div class="icon" style="background: #40C0C9">
                            <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                        </div>
                        <div class="details">
                            <span class="value">₱{{salesSummary.sales | number : '1.2-2'}}</span>
                            <span class="label">REVENUE</span>
                        </div>
                    </div>

                    <div class="widget-wrapper summary">
                        <div class="icon" style="background: #B362B7">
                            <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                        </div>
                        <div class="details">
                            <span class="value">₱{{salesSummary.net_sales | number : '1.2-2'}}</span>
                            <span class="label">NET SALES</span>
                        </div>
                    </div>

                    <div class="widget-wrapper summary">
                        <div class="icon" style="background: #E1145C">
                            <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                        </div>
                        <div class="details">
                            <span class="value">₱{{salesSummary.cost_of_sales | number : '1.2-2'}}</span>
                            <span class="label">COST OF SALES</span>
                        </div>
                    </div>

                    <div class="widget-wrapper summary">
                        <div class="icon" style="background: #00C094">
                            <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                        </div>
                        <div class="details">
                            <span class="value">₱{{salesSummary.gross_profit | number : '1.2-2'}}</span>
                            <span class="label">GROSS PROFIT</span>
                        </div>
                    </div>

                    <div class="widget-wrapper sales-details" *ngIf="productsSalesSummary.length>0">
                        <table class="table table-responsive">
                            <thead>
                            <tr>
                                <th>PRODUCTS</th>
                                <th>COST OF SALES</th>
                                <th>REVENUE</th>
                                <th>NET SALES</th>
                                <th>GROSS PROFIT</th>
                                <th>GROSS MARGIN</th>

                            </tr>
                            </thead>
                            <tbody>
                            <tr *ngFor="let item of productsSalesSummary; let i = index;">
                                <th>{{item.product_name}}</th>
                                <td>₱{{item.cost_of_sales | number : '1.2-2'}}</td>
                                <td>₱{{item.sales | number : '1.2-2'}}</td>
                                <td>₱{{item.net_sales | number : '1.2-2'}}</td>
                                <td class="profit-col">₱{{item.gross_profit | number : '1.2-2'}}</td>
                                <td>{{item.gross_margin*100 | number : '1.2-2' }}%</td>
                            </tr>

                            </tbody>
                        </table>

                    </div>
                </div>
            </div>


        </div>
    </div>
</section>